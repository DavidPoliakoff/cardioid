simulate SIMULATE 
{
   anatomy = niederer;
   decomposition = grid;
   diffusion = fgr;
   reaction = tt06;
   //stimulus = s1 s2;
   stimulus = s1;
   //sensor = arTime;
   sensor = ecg;
   loop = 0;            // in timesteps
   maxLoop = 50000;     // in timesteps
   dt = 0.02;       // msec
   time = 0;            // msec
   printRate = 1;      // in timesteps
   parallelDiffusionReaction = 0;
   checkRanges=0;
}

niederer ANATOMY 
{
   method = brick;
   cellType = 102;
   dx = 0.10;   // in mm
   dy = 0.10;   // in mm
   dz = 0.10;   // in mm
   xSize = 3; 
   ySize = 7;
   zSize = 20;
   conductivity = conductivity;
}

grid DECOMPOSITION 
{
    method = grid;
    nx = 1;
    ny = 2;
    nz = 2;
}

fgr DIFFUSION
{
   method = cuda;
   //method = gpu;
   //method = FGR;
   diffusionScale = 714.2857143;      // mm^3/mF
}

conductivity CONDUCTIVITY
{
    method = uniform;
    sigma11 = 0.0001334177;   // units S/mm
    sigma22 = 0.0000176062;   // units S/mm
    sigma33 = 0.0000176062;   // units S/mm
    sigma13 = 0;
    sigma23 = 0;
}

tt06 REACTION
{
    method = BetterTT06;
    cellTypes = 102;
}

s1 STIMULUS
{
   method = box;
   xMax = 15;
   yMax = 15;
   zMax = 15;
   vStim = -35.71429;
   tStart = 0;
   duration = 2;
   period = 10000;
}

s2 STIMULUS
{
   method = box;
   xMin = 14;
   yMin = 54;
   zMin = 184;
   vStim = -35.71429;
   tStart = 565;
   duration = 2;
   period = 10000;
}

arTime SENSOR
{
   method = activationAndRecovery;
   filename = arTime;
   printRate = 1;
   evalRate = 1;
   nFiles = 1;
}

ecg SENSOR 
{
   method = ECG;
   kconst = 0.8;
   printRate = 50000;
   filename = ecgData;
   evalRate = 1;
   nFiles = 1;
   ecgPoints= ePt1 ePt2 ePt3 ePt4 ePt5 ePt6;
}

ePt1 POINT{
   x=1.5;
   y=3.5;
   z=30;
}

ePt2 POINT{
   x=1.5;
   y=3.5;
   z=-10;
}

ePt3 POINT{
   x=1.5;
   y=17;
   z=10;
}

ePt4 POINT{
   x=1.5;
   y=-10;
   z=10;
}

ePt5 POINT{
   x=13;
   y=3.5;
   z=10;
}

ePt6 POINT{
   x=-10;
   y=3.5;
   z=10;
}

tt06 REACTION { fit=BetterTT06_fit; }
BetterTT06_fit FIT {
   dt = 0.02;
   functions = BetterTT06_interpFunc0 BetterTT06_interpFunc1 BetterTT06_interpFunc2 BetterTT06_interpFunc3 BetterTT06_interpFunc4 BetterTT06_interpFunc5 BetterTT06_interpFunc6 BetterTT06_interpFunc7 BetterTT06_interpFunc8 BetterTT06_interpFunc9 BetterTT06_interpFunc10 BetterTT06_interpFunc11 BetterTT06_interpFunc12 BetterTT06_interpFunc13 BetterTT06_interpFunc14 BetterTT06_interpFunc15 BetterTT06_interpFunc16 BetterTT06_interpFunc17 BetterTT06_interpFunc18 BetterTT06_interpFunc19 BetterTT06_interpFunc20 BetterTT06_interpFunc21 BetterTT06_interpFunc22 BetterTT06_interpFunc23 BetterTT06_interpFunc24 BetterTT06_interpFunc25 BetterTT06_interpFunc26 BetterTT06_interpFunc27 BetterTT06_interpFunc28 BetterTT06_interpFunc29 BetterTT06_interpFunc30 ;
}
BetterTT06_interpFunc0 FUNCTION { numer=3; denom=3; coeff=0.9997561273033541 -2.970790994936533e-06 9.706164206705861 -2.97134197590179e-06 9.803713280512889 ; }
BetterTT06_interpFunc1 FUNCTION { numer=3; denom=3; coeff=0.0002438726970151707 -6.578684116450792e-10 0.03901963439431366 -2.971663201773784e-06 9.803716375671216 ; }
BetterTT06_interpFunc2 FUNCTION { numer=14; denom=4; coeff=0.9998907942920848 -0.01034699119201893 -2.081323810791121e-05 3.740255776144184e-07 -1.215538624215523e-10 -1.596769174631398e-12 -1.664223168581006e-14 -1.246692813891957e-16 -7.131575999605478e-19 -1.262137115299828e-21 1.581652727380545e-23 4.547541835160002e-25 3.9886851966061e-27 2.125661123405808e-29 -0.01033939567052744 -2.052492735730707e-05 3.809552631224192e-07 ; }
BetterTT06_interpFunc3 FUNCTION { numer=6; denom=14; coeff=0.0001066021444545833 6.315183017419258e-06 1.872167702079056e-07 2.998913542801123e-09 2.587129320066974e-11 7.074397593316932e-14 -0.02404548541197817 0.0002309599678507907 -1.043895995112844e-05 5.606131649124817e-07 -1.78323860830244e-08 4.112198756775244e-10 -7.420674243936566e-12 1.03908443651091e-13 -1.086988192504508e-15 8.104391717980697e-18 -4.039736342554042e-20 1.202241635675211e-22 -1.612224026945213e-25 ; }
BetterTT06_interpFunc4 FUNCTION { numer=3; denom=9; coeff=0.9934616319032409 -1.814150063453049e-14 -2.927798531082565e-05 -1.82577121710195e-14 -2.872979125073106e-05 -1.926348254568145e-20 1.327969932443843e-10 -4.603616352304281e-25 8.408599585402158e-15 -5.670018619928907e-28 2.180433971756815e-19 ; }
BetterTT06_interpFunc5 FUNCTION { numer=8; denom=6; coeff=0.000162965737864834 -1.610573596612225e-06 1.332094721757409e-08 -4.937629947121514e-11 2.910955707335358e-12 -2.779469767207518e-14 1.966717703758991e-16 -5.577512358636352e-19 0.03074566221215123 0.000414117627490926 2.948209465692437e-06 1.092011404562982e-08 1.666222959707429e-11 ; }
BetterTT06_interpFunc6 FUNCTION { numer=9; denom=11; coeff=0.9999744379008154 -0.005984000688234441 0.001344095393776263 5.833011787166247e-06 3.288638747811395e-07 -6.796220174048534e-09 6.505034145522372e-11 -3.377111516517445e-13 4.675206120540072e-15 -0.005985350945553071 0.001344199484942823 5.830168059235068e-06 3.289493948293751e-07 -6.797461032330114e-09 6.50681027224523e-11 -3.378156501915158e-13 4.676269938463099e-15 3.507848068843997e-22 2.34014778840539e-24 ; }
BetterTT06_interpFunc7 FUNCTION { numer=11; denom=11; coeff=1.503822857053229e-05 -2.247501791750036e-07 4.211037621403186e-08 1.098373238202177e-10 2.195633701483382e-11 2.611600832209721e-13 2.082964209806558e-15 7.655969465174053e-17 1.171066943966077e-18 7.188647300270141e-21 1.599927616617707e-23 0.002502781373967646 0.001955619962614376 9.068537118781196e-06 1.004540064607228e-06 -8.719808564872667e-09 1.311166572119787e-10 -4.039990688849316e-12 6.207704105476201e-14 -2.870544076352443e-16 7.067797173958279e-19 ; }
BetterTT06_interpFunc8 FUNCTION { numer=12; denom=9; coeff=0.9703115475082498 -0.06755175749115724 0.003738873419387472 -1.130827461478627e-05 1.467849225788759e-06 2.894334833644715e-08 4.088262111970003e-10 2.22403494448672e-12 5.142262403859545e-14 4.240651473641249e-18 -9.478682922057879e-22 -3.20495659292106e-23 -0.06598392771378604 0.003880879666669768 -8.98896223147674e-06 1.527202409088968e-06 2.915454139580861e-08 4.170968128748918e-10 2.22046339087425e-12 5.332959917621523e-14 ; }
BetterTT06_interpFunc9 FUNCTION { numer=12; denom=11; coeff=0.02208307626792587 0.002092442957036481 0.0001630017447190906 6.677503503028822e-06 1.602938160652055e-07 2.314663947812915e-09 2.3446611384532e-11 2.874972575627496e-13 4.242897742500571e-15 4.184466299183031e-17 2.148588450000855e-19 4.41252381065525e-22 -0.05813149198147253 0.004572612515474795 -7.451092792601501e-05 7.330758759608543e-06 -4.552997684639145e-08 3.221313520289496e-09 1.209837490396829e-12 4.001008815727647e-13 5.429307448926614e-17 2.170984432556118e-17 ; }
BetterTT06_interpFunc10 FUNCTION { numer=11; denom=18; coeff=0.9993958954080726 -0.08923032945711425 0.005745539667869946 8.095374141497684e-05 1.058045307541886e-06 2.398363493373126e-07 6.825209962062358e-09 9.706955850111171e-11 1.986628391693734e-12 3.481809709919697e-14 2.4370270426433e-16 -0.08917088343798404 0.005749289658039223 8.111255583682594e-05 1.063017182964718e-06 2.399569504501906e-07 6.828061339649713e-09 9.714204039907686e-11 1.98816649534712e-12 3.483841104989196e-14 2.43838969513936e-16 2.880488118537131e-22 -1.17021099240325e-25 -8.733972118088397e-27 -4.636454807764159e-30 2.901276742318004e-31 1.044330489250998e-34 -4.758034134829954e-36 ; }
BetterTT06_interpFunc11 FUNCTION { numer=16; denom=13; coeff=0.0002020761523046596 2.220543269148818e-05 1.517917187071727e-06 7.042000206228782e-08 2.502969517517806e-09 7.087578492336767e-11 1.795977129728064e-12 4.284084834462515e-14 9.618931334875278e-16 1.794533194131297e-17 2.386160300965562e-19 1.916044044344903e-21 7.276111715391409e-24 1.314370530599041e-27 1.894449885375434e-30 -4.027121097251125e-32 -0.0757699006740629 0.004625671092961346 0.0001527850121824969 2.577491488529426e-06 2.618100515038361e-07 1.056856995279645e-08 2.261424365945951e-10 4.278234717023885e-12 8.116495806612259e-14 1.137405564634008e-15 9.211911592693881e-18 3.35627831303357e-20 ; }
BetterTT06_interpFunc12 FUNCTION { numer=14; denom=13; coeff=0.9998254142916007 0.04304385430712165 0.01056644558303127 0.0005308093329511151 2.378225302244594e-05 9.901734329427274e-07 2.967689208773202e-08 6.695934906624304e-10 1.238772259908952e-11 1.827637630294566e-13 2.011851411510926e-15 1.508549890588644e-17 6.081751464396493e-20 4.287992126521552e-28 0.04306327573763878 0.01056780900312589 0.0005308771321120556 2.378494615159309e-05 9.902625494493307e-07 2.967943009042633e-08 6.696539643415892e-10 1.238887240814029e-11 1.827804323887846e-13 2.012032160156651e-15 1.508686944141773e-17 6.082316394365343e-20 ; }
BetterTT06_interpFunc13 FUNCTION { numer=10; denom=21; coeff=9.482174987193467e-06 3.087263725802913e-07 1.377463623516154e-08 3.009903465877186e-10 8.797228118910253e-12 2.167474898584118e-14 -1.338191455894949e-15 -2.08806713146402e-17 3.381207007952258e-19 -1.134720022700498e-21 0.09947586057120601 0.01441081194388517 0.001203372935338723 6.991748855662049e-05 3.262738587497233e-06 1.314296067510551e-07 4.346618942122418e-09 1.122160890174205e-10 2.373457168988658e-12 4.576828969871137e-14 8.186293482776883e-16 1.239144850333267e-17 1.514618839464507e-19 1.629582093177838e-21 1.763948144224544e-23 1.810742181718423e-25 1.44562514377452e-27 7.695281769138241e-30 2.379977394820553e-32 3.226799751934569e-35 ; }
BetterTT06_interpFunc14 FUNCTION { numer=31; denom=30; coeff=0.9178964742581588 0.1954842501161978 0.01955805225265457 0.001219421039057228 5.230920381754964e-05 1.572057594165861e-06 3.059716570072103e-08 2.211383173635851e-10 -7.727770299756383e-12 -3.093442961141196e-13 -4.896756588643519e-15 -9.214417260315993e-18 1.211341249807271e-18 2.39406304874596e-20 1.248107369597756e-22 -2.530698865911397e-24 -5.19950548870689e-26 -3.026966501672253e-28 2.286786639529748e-30 5.570453411924494e-32 4.060926308553371e-34 -3.642450668129634e-37 -3.250692260650716e-38 -2.526641379709783e-40 -4.562746431648105e-43 5.464954219568839e-45 5.354952075385459e-47 2.854778419113466e-49 9.568568326620728e-52 1.445372130281297e-54 2.438270075559109e-59 0.2151062342426681 0.02172178585379011 0.001364682614051798 5.885699191948626e-05 1.774551951034869e-06 3.45883583801693e-08 2.496650896842684e-10 -8.755598927308408e-12 -3.494764476977561e-13 -5.506547679512821e-15 -9.900872791592859e-18 1.365236064650498e-18 2.684174909561039e-20 1.398494980565151e-22 -2.829940901350042e-24 -5.842654762483064e-26 -3.434207106895313e-28 2.566342927638197e-30 6.299510557760468e-32 4.570270482130089e-34 -4.30564363909794e-37 -3.651588447371327e-38 -2.836162190796544e-40 -5.202435399405455e-43 6.14398727715568e-45 6.052433180368495e-47 3.207573789239939e-49 1.07453178273647e-51 1.644492442858103e-54 ; }
BetterTT06_interpFunc15 FUNCTION { numer=5; denom=23; coeff=1.482763461935725e-10 -6.567547563095912e-12 9.39730400677396e-14 -6.063628244260171e-16 2.005356587239586e-18 0.2555593098147791 0.03513876651332862 0.003147996970313079 0.0001865395384592212 7.244841636397175e-06 1.953962423868836e-07 5.739239598823763e-09 2.952364954807816e-10 1.482141502666037e-11 5.254374135918274e-13 1.289346064601073e-14 2.198002323244611e-16 2.494004189379508e-18 1.498579272981545e-20 -4.570631577870224e-23 -2.082209789332522e-24 -2.400521945533902e-26 -1.652796827938895e-28 -7.414859507621066e-31 -2.121325577632488e-33 -3.490907715821389e-36 -2.467777872950072e-39 ; }
BetterTT06_interpFunc16 FUNCTION { numer=27; denom=24; coeff=0.9885362045195463 0.1632452538844215 0.01148642875120909 0.0004302177986798509 8.082563746307269e-06 1.27050163147822e-08 -2.714875180058483e-09 -4.757156557719056e-11 5.476480988618012e-14 1.024624355279367e-14 7.389748696121594e-17 -9.902204046206803e-19 -1.377812290047107e-20 4.84271185430804e-23 1.327561933443637e-24 -7.527266572154453e-28 -8.701350843494604e-29 -8.212365282214626e-32 4.345025767676221e-33 1.038114743553331e-35 -1.644307021040914e-37 -6.173376263895567e-40 3.858712685843085e-42 1.727056163961425e-44 -1.344152068474081e-47 -2.372285275332829e-49 -6.238857754270659e-52 0.1658407351103699 0.0117550920244738 0.0004469659052878467 8.777267123844624e-06 3.255403635720165e-08 -2.331250441396052e-09 -4.318244554923177e-11 6.169351429206925e-14 9.519699646237252e-15 6.101612863042679e-17 -1.066904609387723e-18 -1.308266373587384e-20 6.545628469488583e-23 1.440873008218199e-24 -1.142297405972879e-27 -9.951454465632842e-29 -1.62803321541027e-31 4.476815863532987e-33 1.608769435525787e-35 -1.290581643146443e-37 -6.476540309532216e-40 2.174445468653887e-42 9.324372563918559e-45 ; }
BetterTT06_interpFunc17 FUNCTION { numer=17; denom=16; coeff=4.941837050166008e-11 -1.695143615302027e-13 -6.883575628182486e-14 8.048566059525092e-16 3.801718558192034e-17 -7.666982294171721e-19 -8.345016619346083e-21 3.117493476716141e-22 -2.192098890927707e-25 -6.194602512960993e-26 4.290313516059912e-28 5.304478310086046e-30 -7.101053685841388e-32 -1.001019216859932e-35 3.695728965808184e-36 -1.812147334255104e-38 2.252409129836963e-41 0.205176236240449 0.01984580720840584 0.001198664598857267 5.044391755209172e-05 1.562624414475675e-06 3.671095721351696e-08 6.644073187833407e-10 9.320072494357358e-12 1.011609834606083e-13 8.41556417407668e-16 5.264161336082658e-18 2.395018713034003e-20 7.478060076258012e-23 1.432268896247003e-25 1.268145973166099e-28 ; }
BetterTT06_interpFunc18 FUNCTION { numer=10; denom=22; coeff=0.7010425029110787 0.09006108416237614 0.005148909926797154 0.0001693350009103517 3.511921295328072e-06 4.760021036473019e-08 4.2212553513324e-10 2.365979200976242e-12 7.619279850541471e-15 1.07594718783555e-17 0.1293580502765693 0.007450523393283649 0.0002476896946332082 5.218668475745153e-06 7.241202633387135e-08 6.676872117480387e-10 4.03439824499575e-12 1.519734798683818e-14 3.238356093293646e-17 1.013913158820125e-19 4.430690000519817e-22 -1.14330372553126e-23 2.417233155187613e-26 1.599001915656592e-27 -1.185037139831051e-29 -9.29194009626166e-32 1.353618822075276e-33 -1.034122109138719e-36 -5.157292592244057e-38 2.620840028197403e-40 -3.60739957108291e-43 ; }
BetterTT06_interpFunc19 FUNCTION { numer=10; denom=19; coeff=0.2978590521223807 0.03948340144573633 0.00232956894628456 7.977622644761728e-05 1.741143139179768e-06 2.506566727308458e-08 2.377664137634911e-10 1.432387916033006e-12 4.972759357255605e-15 7.581764240057898e-18 0.1300614295707125 0.0075399070631789 0.0002522301983180595 5.326495229053212e-06 7.304411738330839e-08 6.396592690050886e-10 3.300562809180415e-12 7.925179227076482e-15 -4.56270785672979e-19 -1.033661813735229e-19 -2.986366250577307e-22 1.443110301696725e-23 -3.772921228641639e-26 -1.373036153332865e-27 1.027250163740825e-29 3.595016232134554e-32 -6.156030271366807e-34 1.78872687815029e-36 ; }
BetterTT06_interpFunc20 FUNCTION { numer=10; denom=7; coeff=0.9957587403394664 -0.02241372618474394 0.0002336684809857301 2.72569282283017e-06 -1.750850820650891e-08 9.066712563466856e-11 2.234629586858644e-12 -1.017834863829743e-16 -4.967576432830466e-19 2.226042021420121e-21 -0.02235240685165605 0.0002354062845873847 2.744011635633994e-06 -1.722589918508742e-08 9.28302274594946e-11 2.257212416117891e-12 ; }
BetterTT06_interpFunc21 FUNCTION { numer=4; denom=17; coeff=0.0001460909458216809 3.241950031929386e-06 3.020144364208121e-08 1.082039436768144e-10 -0.1755438170914329 0.01551054110625857 -0.0008910542940126034 3.707759708031882e-05 -1.183397411499107e-06 2.995800902881923e-08 -6.131201893067076e-10 1.023428439827265e-11 -1.39381670961294e-13 1.537182425685984e-15 -1.351403400492853e-17 9.232007826466655e-20 -4.71100526675484e-22 1.684802090138736e-24 -3.756262438262823e-27 3.919036426792871e-30 ; }
BetterTT06_interpFunc22 FUNCTION { numer=14; denom=12; coeff=0.9989606000769935 -0.02819250074135048 0.002457458301623117 -1.509262420350588e-05 6.365499571060153e-07 5.910656802388787e-09 4.327532438514651e-11 1.157051004405655e-12 8.184212094456705e-15 4.786273357223739e-17 4.082450157177239e-19 1.215435417232877e-21 -3.737674784968165e-27 8.898567191687596e-30 -0.02814044961290611 0.002459245399736372 -1.504887538020925e-05 6.374180074851303e-07 5.924723329351501e-09 4.346739436479597e-11 1.159237227569353e-12 8.204808171541461e-15 4.801609498551845e-17 4.090897176193164e-19 1.218337485424277e-21 ; }
BetterTT06_interpFunc23 FUNCTION { numer=5; denom=17; coeff=3.829405161803581e-06 -1.400682163848628e-07 1.970932826703299e-09 -1.261700912882869e-11 3.092996162872157e-14 0.08446646528235201 0.005084332191778025 0.0002718356048960863 1.156486340165049e-05 3.607340012773674e-07 8.90446873714776e-09 1.844476977894922e-10 3.337726549802383e-12 5.250173131247749e-14 6.931517027357969e-16 7.551840196285972e-18 6.744042078519518e-20 4.7394875701475e-22 2.387347640135732e-24 7.416316396127144e-27 1.045503555906577e-29 ; }
BetterTT06_interpFunc24 FUNCTION { numer=3; denom=4; coeff=0.9999893097609448 0.005277977123885418 8.632266370079024e-06 -0.007823224550843543 2.527978401590728e-05 -3.505045906033751e-08 ; }
BetterTT06_interpFunc25 FUNCTION { numer=4; denom=5; coeff=0.9999990298470902 -0.01057992491639949 4.341498539589793e-05 -7.025493792472211e-08 0.01375173937498875 8.199573868637085e-05 2.554001212431883e-07 3.548204926771272e-10 ; }
BetterTT06_interpFunc26 FUNCTION { numer=7; denom=5; coeff=321192.1069879727 -11384.44830865047 179.6983120528279 -1.614138492117498 0.008659820327012851 -2.607189652680511e-05 3.392546153524357e-08 -0.004874097618124787 0.0001627227467135133 -1.993656305002796e-07 3.155541086474402e-09 ; }
BetterTT06_interpFunc27 FUNCTION { numer=5; denom=7; coeff=104481.8509672722 2832.509751459364 31.17041479982889 0.1647996730380308 0.0003516066486622763 -0.01718779628548507 0.0002980262286934959 -2.703258334198293e-06 1.706475694708216e-08 -6.462683291594638e-11 1.127062293861782e-13 ; }
BetterTT06_interpFunc28 FUNCTION { numer=6; denom=3; coeff=1.981698060418568 0.02663743867251982 0.0001238182841387063 1.313438881570056e-07 -3.533256997723566e-10 3.824720025184617e-13 0.01190028867170379 6.384062096548559e-05 ; }
BetterTT06_interpFunc29 FUNCTION { numer=8; denom=13; coeff=0.01505905222788931 0.0009407226280886678 2.632281565291848e-05 4.271284597308065e-07 4.331071387304512e-09 2.735638835500205e-11 9.926292540594703e-14 1.588916540568041e-16 -0.1022370150023938 0.005230370145717274 -0.0001668885001993144 3.82627143089342e-06 -6.531746815348242e-08 8.565945607254651e-10 -8.649994348256271e-12 6.654386379080093e-14 -3.782744321437802e-16 1.499101550154606e-18 -3.694901696986857e-21 4.256885850345121e-24 ; }
BetterTT06_interpFunc30 FUNCTION { numer=13; denom=15; coeff=0.001118642871430289 0.2944728379192348 -0.01787736785093248 0.009241662640719758 -0.0005267866898141191 3.856325243549317e-05 -1.352266742927005e-06 3.322078437303386e-08 -5.649942628663927e-10 6.169745983139915e-12 -4.098392152963128e-14 1.513537754004187e-16 -2.394591188708498e-19 0.1866070643328728 0.01874509837741737 0.0008095262561991112 4.016603137725885e-05 6.992446647521811e-07 3.121147999495282e-08 5.253266606486538e-10 1.46833969923091e-11 2.157540178768035e-13 2.684759234210444e-15 2.180202820330521e-17 1.174856410096913e-19 3.715199525029524e-22 5.238079416274811e-25 ; }
